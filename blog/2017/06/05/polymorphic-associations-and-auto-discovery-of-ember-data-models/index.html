<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Polymorphic associations and auto-discovery of Ember Data models &middot; Ember CLI Mirage
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/style.css">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-144-precomposed.png">
                                 <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body>
    <div class="Topbar">
      <div class="Container">
      </div>
    </div>

    <header class="Header">
  <div class="Container">
    <nav class='Header__nav'>
      <ul class='Header__nav-list'>
        <li class='Header__nav-item'>
          <a href='/docs/v0.4.x' class="Header__nav-item-link">
            <span class="u-mobile">Docs</span>
            <span class="u-desktop">Documentation</span>
          </a>
        </li>
        <li class='Header__nav-item'>
          <a href='/blog' class="Header__nav-item-link active">Blog</a>
        </li>
        <li class='Header__nav-item'>
          <a href='/about' class="Header__nav-item-link">About</a>
        </li>
        <li class='Header__nav-item'>
          <a href="https://github.com/samselikoff/ember-cli-mirage" class='Header__nav-item-link' target="_blank">GitHub</a>
        </li>
      </ul>
    </nav>
    <a class="Header__logo" href="/">
      <span class='Header__logo-minor'>Ember CLI</span><br>
      <span class='Header__logo-major'>Mirage</span>
    </a>
  </div>
</header>


    <div class="Wrapper">
      <div class="Content">
        <div class="Blog">
  <div class='Blog__post'>
    <div class="Blog__post-info">
      <h1 class='Blog__title'>Polymorphic associations and auto-discovery of Ember Data models</h1>
      <p class='Blog__byline'>June 5, 2017</p>
      <hr class='Blog__divider'>
    </div>
    <div class='Blog__content'>
      <p><em>Thanks to <a href="http://www.precisionnutrition.com/">Precision Nutrition</a> for sponsoring some of Mirage’s recent work!</em></p>

<p>In the last few weeks there’s been two important releases of Ember CLI Mirage. Version <a href="https://github.com/samselikoff/ember-cli-mirage/releases/tag/v0.3.2">0.3.2</a> bought along auto-discovery of Ember Data models, and version <a href="https://github.com/samselikoff/ember-cli-mirage/releases/tag/v0.3.3">0.3.3</a> (which I released over the weekend) added support for Polymorphic associations.</p>

<p>Taken together, these two features greatly improve the ergonomics of the library.</p>

<h2 id="auto-discovery-of-ember-data-models">Auto-discovery of Ember Data models</h2>

<p>In 0.3.2, <a href="https://twitter.com/Offir_Golan">Offir Golan</a> shipped the auto-discovery feature.</p>

<p>Models in Mirage are used by the ORM to set up collections and define relationships (associations). With this new feature, if you happen to be using Ember Data, Mirage will now auto-discover your Ember Data models (and their associations), and use those for its own schema.</p>

<p>This is quite a convenient step, because if you’re using Ember Data your Mirage models should match your Ember Data models anyway. Local files in <code class="highlighter-rouge">mirage/models</code> will “win” against auto-generated definitions, but once you delete your local files Mirage will fall back to Ember Data’s schema.</p>

<p>So, if you’re using Ember Data, upgrade to the latest version of Mirage, nuke your <code class="highlighter-rouge">mirage/models</code> folder, and you never have to worry about running <code class="highlighter-rouge">ember g mirage-model</code> again!</p>

<h2 id="polymorphic-associations">Polymorphic associations</h2>

<p>Polymorphic associations were the last big missing piece of Mirage’s ORM. Now, Mirage can represent any schema that Ember Data can.</p>

<p>Reaching parity with Ember Data’s flexible data-modeling story makes the auto-discovery feature that much more valuable. Now, no matter how you’re using Ember Data, you should be able to rely on the autogenerated model classes.</p>

<p>If you aren’t using Ember Data, you can define has-many or belongs-to polymorphic associations on your own Mirage models:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// mirage/models/user.js</span>
<span class="k">export</span> <span class="k">default</span> <span class="nx">Model</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
  <span class="na">collectibles</span><span class="p">:</span> <span class="nx">hasMany</span><span class="p">({</span> <span class="na">polymorphic</span><span class="p">:</span> <span class="kc">true</span> <span class="p">})</span>
<span class="p">});</span>

<span class="c1">// mirage/models/car.js</span>
<span class="k">export</span> <span class="k">default</span> <span class="nx">Model</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
  <span class="na">user</span><span class="p">:</span> <span class="nx">belongsTo</span><span class="p">()</span>
<span class="p">});</span>

<span class="c1">// mirage/models/watch.js</span>
<span class="k">export</span> <span class="k">default</span> <span class="nx">Model</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
  <span class="na">user</span><span class="p">:</span> <span class="nx">belongsTo</span><span class="p">()</span>
<span class="p">});</span>

<span class="nx">schema</span><span class="p">.</span><span class="nx">users</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span>
  <span class="na">collectibles</span><span class="p">:</span> <span class="p">[</span>
    <span class="nx">schema</span><span class="p">.</span><span class="nx">cars</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span> <span class="na">make</span><span class="p">:</span> <span class="s2">"Infiniti"</span><span class="p">,</span> <span class="na">model</span><span class="p">:</span> <span class="s2">"J30t"</span> <span class="p">}),</span>
    <span class="nx">schema</span><span class="p">.</span><span class="nx">watches</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span> <span class="na">make</span><span class="p">:</span> <span class="s2">"Citizen"</span><span class="p">,</span> <span class="na">model</span><span class="p">:</span> <span class="s2">"Men's Chronograph"</span> <span class="p">}),</span>
  <span class="p">]</span>
<span class="p">});</span>
</code></pre></div></div>

<p>Just like all other associations in Mirage’s ORM, they can be one-way (null inverse), one-to-one, one-to-many or many-to-many. Check out <a href="http://www.ember-cli-mirage.com/docs/v0.3.x/models/#association-options">the docs on polymorphic associations</a> for more details.</p>

<h2 id="upgrading">Upgrading</h2>

<p>These past few releases are all backwards-compatible with the 0.3.x series. If you’re still on 0.2.x, be sure to check out the <a href="http://www.ember-cli-mirage.com/docs/v0.3.x/upgrading/">upgrade guide</a> so you can get on the 0.3 series.</p>

<!-- ## Example

[Here's a Twiddle]() demonstrating Mirage's new features: notice there's no `models` folder, and the default scenario seeds Mirage's database with polymorphic data. -->

<h2 id="roadmap">Roadmap</h2>

<p>Now that the majority of the work on the ORM is complete, there’s a few things I’ll be focusing on:</p>

<ul>
  <li>
    <p><strong>Real network requests.</strong> There’s a PR that needs a bit of attention, but soon Mirage will have an option to boot in Ember CLI’s Express server and send real HTTP responses back to your Ember app. This will enable several things:</p>

    <ol>
      <li>You’ll be able to use the network inspector to view your responses</li>
      <li>Mirage’s database state will persist across page refreshes of your application, and</li>
      <li>You’ll be able to test out features that depend on a real server, like verifying polling updates across two browser tabs</li>
    </ol>

    <p>Mirage will always be a tool focused on improving the development experience. Even though it will be able to run as a true node server, it will never make compromises to the developer experience in order to accommodate the needs of an actual production server.</p>
  </li>
  <li>
    <p><strong>Landing a version 1.0.</strong> I’m happy with Mirage’s API and I’d like to land a version 1.0 soon. The only possible breaking change I’m considering at the moment has to do with the database API.</p>

    <p>Before the ORM you would interact with Mirage’s db directly, doing things like <code class="highlighter-rouge">db.users</code> to fetch users and <code class="highlighter-rouge">db.users.insert</code> to insert new records.</p>

    <p>When designing this API I wanted <code class="highlighter-rouge">db.users</code> to return a JavaScript array but I also wanted <code class="highlighter-rouge">insert</code>, <code class="highlighter-rouge">update</code> and <code class="highlighter-rouge">destroy</code> to live off of this collection, e.g. <code class="highlighter-rouge">db.users.insert()</code>, <code class="highlighter-rouge">db.users.update()</code> and <code class="highlighter-rouge">db.users.destroy()</code>.</p>

    <p>Having <code class="highlighter-rouge">db.users</code> return the underlying database records made it way too easy to inadvertently mutate the database, so I made an early decision to have <code class="highlighter-rouge">db.users</code> return a copy of the records using <code class="highlighter-rouge">JSON.stringify</code>. This is quite costly in terms of performance and some users have hit limits when trying to seed their dummy data.</p>

    <p>Now that the primary interface to the database is <code class="highlighter-rouge">schema</code> (Mirage’s ORM), the database’s API isn’t as important, and we could change <code class="highlighter-rouge">db.users</code> to <code class="highlighter-rouge">db.users.all()</code>. That way the other db methods (<code class="highlighter-rouge">db.insert</code>, <code class="highlighter-rouge">db.update</code> and <code class="highlighter-rouge">db.delete</code>) wouldn’t incur the expensive cost of copying the database each time they ran.</p>

    <p>Other than that, I think we can lock down the API, ship 1.0 and move forward with prioritizing other features that are on the horizon.</p>
  </li>
</ul>

<h2 id="how-you-can-help">How you can help</h2>

<p>Test your apps on 0.3.3 and report any issues that you run into, especially if your app has complex Ember Data schemas.</p>

<p>And as always, if you’d like to contribute code or documentation to Mirage, jump on the #ec-mirage Slack channel and reach out. There’s always more work to be done! :)</p>

      
      <div id="disqus_thread"></div>
    </div>
  </div>
</div>


<script>
/**
* RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
* LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
*/
/*
var disqus_config = function () {
this.page.url = PAGE_URL; // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
*/
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');

s.src = '//emberclimirage.disqus.com/embed.js';

s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

      </div>
    </div>

    <footer class="Footer">
  <div class="Container Grid Grid--gutters Grid--full med-Grid--fit">
    <div class="Grid-cell">
      <p>Project and site maintained by <a href="https://twitter.com/samselikoff">Sam Selikoff</a> and <a href="https://github.com/samselikoff/ember-cli-mirage/graphs/contributors">contributors</a>.</p>
      <p>Sponsored by <a href="https://embermap.com/">EmberMap</a>.<p>
    </div>
    <div class="Grid-cell">
      <div class="Github-stars">
        <iframe src="https://ghbtns.com/github-btn.html?user=samselikoff&repo=ember-cli-mirage&type=star&count=true" frameborder="0" scrolling="0" width="170px" height="20px"></iframe>
      </div>
    </div>
  </div>
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/1.1.1/anchor.min.js"></script>
<script>
  /* global anchors */
  // anchors.options = {
  //   placement: 'left',
  //   visible: 'always'
  // };
  anchors.add('h2:not(.Home-page__feature-heading)');
</script>


  </body>
</html>
